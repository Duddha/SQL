select row_number() over(partition by "Подразделение" order by "Участок", "Улица", "Ф.И.О.") "№ п/п",
       "Подразделение",
       "Участок",
       "Улица",
       "Таб. №",
       "Ф.И.О."
  from (select decode("Статус",
                      'Пенсионер',
                      'Пенсионеры',
                      "Цех") "Подразделение",
               decode("Улица",
                      'Григорьевского десанта д.10',
                      '2',
                      'Григорьевского десанта д.12',
                      '2',
                      'Григорьевского десанта д.14',
                      '2',
                      'Григорьевского десанта д.19',
                      '4',
                      'Григорьевского десанта д.20',
                      '3',
                      'Григорьевского десанта д.21',
                      '4',
                      'Григорьевского десанта д.22',
                      '4',
                      'Григорьевского десанта д.22а',
                      '7',
                      'Григорьевского десанта д.23',
                      '4',
                      'Григорьевского десанта д.24',
                      '4',
                      'Григорьевского десанта д.26',
                      '4',
                      'Григорьевского десанта д.28',
                      '4',
                      'Григорьевского десанта д.30',
                      '4',
                      'Григорьевского десанта д.30/16',
                      '4',
                      'Кедровая д.96',
                      '5',
                      'Коммунальная д.7',
                      '5',
                      'Ленина д.1',
                      '6',
                      'Ленина д.10',
                      '?',
                      'Ленина д.13',
                      '3',
                      'Ленина д.15',
                      '3',
                      'Ленина д.16',
                      '2',
                      'Ленина д.17',
                      '3',
                      'Ленина д.17а',
                      '3',
                      'Ленина д.20',
                      '3',
                      'Ленина д.21',
                      '7',
                      'Ленина д.22',
                      '3',
                      'Ленина д.23',
                      '3',
                      'Ленина д.25',
                      '7',
                      'Ленина д.26',
                      '3',
                      'Ленина д.28',
                      '1',
                      'Ленина д.5',
                      '6',
                      'Ленина д.7',
                      '5',
                      'Ленина д.9',
                      '5',
                      'МИЗ, Кедровая д.17',
                      '5',
                      'МИЗ, ул. Одесская д.20',
                      '5',
                      'МИЗ Центральная д.1',
                      '5',
                      'Новобелярская д.1',
                      '6',
                      'Новобелярская д.20',
                      '6',
                      'Новобелярская д.22',
                      '6',
                      'Новобелярская д.26',
                      '6',
                      'Новобелярская д.28',
                      '6',
                      'Новобелярская д.28/2',
                      '6',
                      'Новобелярская д.30',
                      '6',
                      'Приморская д.11',
                      '2',
                      'Приморская д.13',
                      '2',
                      'Приморская д.15',
                      '2',
                      'Приморская д.19',
                      '1',
                      'Приморская д.21',
                      '1',
                      'Солнечная д.41',
                      '5',
                      'Солнечная д.6',
                      '5',
                      'Строителей д.1',
                      '1',
                      'Строителей д.13',
                      '7',
                      'Строителей д.16',
                      '?',
                      'Строителей д.20',
                      '?',
                      'Строителей д.21',
                      '7',
                      'Строителей д.3',
                      '1',
                      'Строителей д.7',
                      '1',
                      'Строителей д.9',
                      '1',
                      'Химиков д.10',
                      '5',
                      'Химиков д.12',
                      '5',
                      'Химиков д.1/3',
                      '6',
                      'Химиков д.14',
                      '5',
                      'Химиков д.16',
                      '5',
                      'Химиков д.18',
                      '4',
                      'Химиков д.2',
                      '6',
                      'Химиков д.20',
                      '3',
                      'Химиков д.22',
                      '7',
                      'Химиков д.28',
                      '?',
                      'Химиков д.4',
                      '6',
                      'Химиков д.6',
                      '6',
                      'Химиков д.8',
                      '6',
                      'Центральная д.1',
                      '5',
                      'Центральная д.2',
                      '5') "Участок",
               "Улица",
               "Таб. №",
               "Ф.И.О."
          from (select rbf.id_tab "Таб. №",
                       rbf.fam_u || ' ' || rbf.f_name_u || ' ' ||
                       rbf.s_name_u "Ф.И.О.",
                       rbkey.dept_name "Цех",
                       --lower(strt.snam_u) || ' ' ||
                       decode(adr.name_line_u,
                              'Гр. десанта',
                              'Григорьевского десанта',
                              'Григ. десанта',
                              'Григорьевского десанта',
                              'Григор. десанта',
                              'Григорьевского десанта',
                              'Гр. Десанта',
                              'Григорьевского десанта',
                              'Гр. десента',
                              'Григорьевского десанта',
                              'Гр.Десанта',
                              'Григорьевского десанта',
                              'Гр.десанта',
                              'Григорьевского десанта',
                              'Ново-Белярская',
                              'Новобелярская',
                              'Ново-Билярская',
                              'Новобелярская',
                              'Новобилярская',
                              'Новобелярская',
                              'Ново-Білярська',
                              'Новобелярская',
                              'Новобілярська',
                              'Новобелярская',
                              'Ново-білярська',
                              'Новобелярская',
                              'Ново-билярская',
                              'Новобелярская',
                              'НовоБилярская',
                              'Новобелярская',
                              'Ново - Белярская',
                              'Новобелярская',
                              'Пиморська',
                              'Приморская',
                              'Приморська',
                              'Приморская',
                              'Приморска',
                              'Приморская',
                              'Сонячна',
                              'Солнечная',
                              'Химимков',
                              'Химиков',
                              'Хіміків',
                              'Химиков',
                              adr.name_line_u) || ' д.' ||
                       lower(replace(replace(adr.dom, ' ', ''), '-', '')) "Улица",
                       decode(adr.kvart, '0', '', to_char(adr.kvart)) "№ квартиры",
                       decode(tabs.fl,
                              1,
                              'Работает',
                              2,
                              'Пенсионер',
                              '?') "Статус"
                  from (select id_tab, max(fl) fl
                          from (select id_tab, 1 fl
                                  from qwerty.sp_ka_work
                                union all
                                select id_tab, 2
                                  from qwerty.sp_ka_pens_all
                                 where id_tab not in
                                       (select id_tab
                                          from qwerty.sp_ka_lost
                                         where lost_type = 1))
                         group by id_tab) tabs,
                       qwerty.sp_rb_fio rbf,
                       (select id_tab, pdr.name_u dept_name
                          from qwerty.sp_rb_key rbk,
                               qwerty.sp_stat   s,
                               qwerty.sp_podr   pdr
                         where rbk.id_stat = s.id_stat
                           and s.id_cex = pdr.id_cex) rbkey,
                       qwerty.sp_ka_adres adr,
                       qwerty.sp_line strt
                 where tabs.id_tab = rbf.id_tab
                   and rbf.id_tab = rbkey.id_tab(+)
                   and rbf.id_tab = adr.id_tab
                   and adr.fl = 1
                   and adr.id_sity = 176
                   and adr.id_line = strt.id(+))
         order by "Подразделение",
                  "Участок",
                  "Улица",
                  "Ф.И.О.")
